{% extends "base.html" %}
{% load static %}

{% block title %}Appraisal Wizard - Section B{% endblock %}

{% block content %}

<div id="wizard-container">
<!-- Replace your current script block with this -->
<script>
    document.addEventListener('htmx:configRequest', function(event) {
        const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content') || 
                     document.querySelector('[name=csrfmiddlewaretoken]').value;
        event.detail.headers['X-CSRFToken'] = token;
    });

    document.addEventListener('DOMContentLoaded', function(){
        // Load saved data for the form
        loadSavedData();

        // Get the relationship dropdown and other input div
        const relationshipSelect = document.getElementById('b11_relationship');
        const relationshipOtherDiv = document.getElementById('relationshipOtherDiv');
        
        // Add change event listener
        if (relationshipSelect && relationshipOtherDiv) {
            // Initial check in case "Other" is already selected (from loaded data)
            if (relationshipSelect.value === 'Other') {
                relationshipOtherDiv.classList.remove('hidden');
            }
            
            // Add event listener for changes
            relationshipSelect.addEventListener('change', function() {
                if (this.value === 'Other') {
                    relationshipOtherDiv.classList.remove('hidden');
                } else {
                    relationshipOtherDiv.classList.add('hidden');
                }
            });
        }

        // Setup leadership role toggle
        const leadershipCheckbox = document.getElementById('b_is_leadership_role');
        const leadershipRatings = document.getElementById('leadership-ratings');
        const leadershipIndicator = document.getElementById('leadership-indicator');
        
        if (leadershipCheckbox && leadershipRatings) {
            // Set initial state based on saved data
            if (leadershipCheckbox.checked) {
                leadershipRatings.classList.remove('hidden');
            }
            
            // Add event listener for changes
            leadershipCheckbox.addEventListener('change', function() {
                // Show loading indicator
                leadershipIndicator.classList.remove('hidden');
                
                // Save the change to the server
                const formData = new FormData();
                formData.append('appraisal_id', '{{ appraisal.appraisal_id }}');
                formData.append('section', 'B');
                formData.append('b_is_leadership_role', leadershipCheckbox.checked);
                
                fetch('{% url "appraisals:save_section_data" %}', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    }
                })
                .then(response => response.json())
                .finally(() => {
                    // Toggle visibility based on checkbox state
                    if (leadershipCheckbox.checked) {
                        leadershipRatings.classList.remove('hidden');
                    } else {
                        leadershipRatings.classList.add('hidden');
                    }
                    
                    // Hide loading indicator
                    leadershipIndicator.classList.add('hidden');
                });
            });
        }
    });


    // Add a global error handler to see AJAX errors
    window.addEventListener('error', function(e) {
        console.error('Global error:', e.error);
    });

    function loadSavedData() {
        console.log("Loading saved data...");
        fetch('{% url "appraisals:get_section_data" %}?section=B&appraisal_id={{ appraisal.appraisal_id }}')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log("Received data:", data);
                if (data && data.data) {
                    const formData = data.data;
                    
                    // Populate radio buttons
                    for (const [key, value] of Object.entries(formData)) {
                        const radioButtons = document.querySelectorAll(`input[type="radio"][name="${key}"]`);
                        if (radioButtons && radioButtons.length > 0) {
                            radioButtons.forEach(radio => {
                                if (radio.value === value) {
                                    radio.checked = true;
                                }
                            });
                        }
                        
                        // Also handle text inputs, textareas and selects
                        const field = document.querySelector(`input[type="text"][name="${key}"], input[type="number"][name="${key}"], input[type="date"][name="${key}"], textarea[name="${key}"], select[name="${key}"]`);
                        if (field && value) {
                            field.value = value;
                        }
                        
                       // Handle checkboxes separately
                    const checkbox = document.querySelector(`input[type="checkbox"][name="${key}"]`);
                    if (checkbox) {
                        // More flexible boolean checking
                        const isChecked = value === true || 
                                        value === "true" || 
                                        value === 1 || 
                                        value === "1" || 
                                        value === "on" ||
                                        value === "yes";
                                        
                        console.log(`Setting checkbox ${key} to ${isChecked} (value was ${value})`);
                        checkbox.checked = isChecked;
                        
                        // If this is the leadership checkbox, update visibility
                        if (key === 'b_is_leadership_role' && isChecked) {
                            const leadershipRatings = document.getElementById('leadership-ratings');
                            if (leadershipRatings) {
                                leadershipRatings.classList.remove('hidden');
                            }
                        }
                    }
                    }
                    
                    // Special case for relationship other field
                    if (formData.b11_relationship === "Other" && formData.b11_relationship_other) {
                        const relationshipOtherDiv = document.getElementById('relationshipOtherDiv');
                        if (relationshipOtherDiv) {
                            relationshipOtherDiv.classList.remove('hidden');
                        }
                    }
                }
            })
            .catch(error => {
                console.error('Error loading saved data:', error);
            });
    }

    function saveDraft() {
        // Create a FormData object
        const form = document.getElementById('section-b-form');
        if (!form) {
            console.error("Form not found!");
            showSaveMessage('Error: Form not found', 'error');
            return;
        }
        
        const formData = new FormData(form);
        formData.append('is_draft', 'true');
        
        // Log what we're about to send
        console.log("Saving form data...");
        
        // Show the saving indicator
        const saveIndicator = document.getElementById('save-indicator');
        saveIndicator.classList.remove('htmx-indicator');
        saveIndicator.style.display = 'flex';

        // Debug the form data being sent
        console.log("Form data entries:");
        for (let [key, value] of formData.entries()) {
            console.log(`${key}: ${value}`);
        }
        
        // Use fetch API for more control
        fetch('{% url "appraisals:save_section_data" %}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => {
            console.log("Response status:", response.status);
            if (!response.ok) {
                return response.text().then(text => {
                    throw new Error(`Server error: ${response.status} - ${text || 'No error message'}`);
                });
            }
            return response.text();
        })
        .then(data => {
            console.log('Draft saved successfully:', data);
            showSaveMessage('Draft saved successfully!');
            
            // Optionally reload the saved data to confirm it was saved
            setTimeout(() => loadSavedData(), 1000);
        })
        .catch(error => {
            console.error('Error saving draft:', error);
            showSaveMessage('Error saving draft: ' + error.message, 'error');
        })
        .finally(() => {
            // Hide the saving indicator
            saveIndicator.style.display = 'none';
            saveIndicator.classList.add('htmx-indicator');
        });
    }

    function showSaveMessage(message, type = 'success') {
        const toast = document.createElement('div');
        const bgColor = type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700';
        toast.className = `fixed bottom-4 left-4 ${bgColor} px-4 py-3 rounded z-50 border`;
        toast.innerHTML = message;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.remove();
        }, 3000);
    }
</script>

<meta name="csrf-token" content="{{ csrf_token }}">

<script src="{% static 'appraisals/js/appraisal-batch-save.js' %}"></script>

{% csrf_token  %}
<input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

<form id="section-b-form" method="post" action="">
    {% csrf_token %}
    {{ wizard.management_form }}
    <input type="hidden" name="appraisal_id" value="{{ appraisal.appraisal_id }}">
    <input type="hidden" name="section" value="B">

<!-- Appraisal Wizard Section B -->
<div class="max-w-5xl mx-auto bg-white shadow-md rounded-lg p-6 mb-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-2">Section B: Appraisal of General Traits</h2>
    <p class="text-sm text-gray-600 mb-6 pb-2 border-b border-gray-200">
        <span class="font-medium">Rating Scale:</span> 
        1 - Outstanding, 2 - Good, 3 - Satisfactory, 4 - Unsatisfactory
    </p>

        <!-- B1. General Traits -->
        <div class="mb-8  bg-gray-50 rounded-lg shadow-sm p-5 border border-gray-100">
            <h3 class="text-xl font-semibold text-gray-700 mb-4 pb-2 border-b border-gray-200"">B1. General Traits</h3>
            
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Effective work output</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b1_effective_work" id="b1_effective_work_1" value="1" required>
                        <label class="ml-2 text-gray-700" for="b1_effective_work_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b1_effective_work" id="b1_effective_work_2" value="2">
                        <label class="ml-2 text-gray-700" for="b1_effective_work_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b1_effective_work" id="b1_effective_work_3" value="3">
                        <label class="ml-2 text-gray-700" for="b1_effective_work_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b1_effective_work" id="b1_effective_work_4" value="4">
                        <label class="ml-2 text-gray-700" for="b1_effective_work_4">4</label>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Reliability in carrying out duties</label>
                <div class="flex items-center gap-4">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_reliability" id="b1_reliability_1" value="1" required>
                        <label class="ml-1 text-gray-700" for="b1_reliability_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_reliability" id="b1_reliability_2" value="2">
                        <label class="ml-1 text-gray-700" for="b1_reliability_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_reliability" id="b1_reliability_3" value="3">
                        <label class="ml-1 text-gray-700" for="b1_reliability_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_reliability" id="b1_reliability_4" value="4">
                        <label class="ml-1 text-gray-700" for="b1_reliability_4">4</label>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Punctuality at lectures, tutorials, practicals/lab sessions, meetings</label>
                <div class="flex items-center gap-4">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_punctuality" id="b1_punctuality_1" value="1" required>
                        <label class="ml-1 text-gray-700" for="b1_punctuality_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_punctuality" id="b1_punctuality_2" value="2" required>
                        <label class="ml-1 text-gray-700" for="b1_punctuality_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_punctuality" id="b1_punctuality_3" value="3" required>
                        <label class="ml-1 text-gray-700" for="b1_punctuality_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_punctuality" id="b1_punctuality_4" value="4" required>
                        <label class="ml-1 text-gray-700" for="b1_punctuality_4">4</label>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Organisation of practicals, tutorials and field work, etc</label>
                <div class="flex items-center gap-4">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_organisation" id="b1_organisation_1" value="1" required>
                        <label class="ml-1 text-gray-700" for="b1_organisation_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_organisation" id="b1_organisation_2" value="2" required>
                        <label class="ml-1 text-gray-700" for="b1_organisation_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_organisation" id="b1_organisation_3" value="3" required>
                        <label class="ml-1 text-gray-700" for="b1_organisation_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                               type="radio" name="b1_organisation" id="b1_organisation_4" value="4" required>
                        <label class="ml-1 text-gray-700" for="b1_organisation_4">4</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- B2. Inter-personal Relations -->
        <div class="mb-8 bg-gray-50 rounded-lg shadow-sm p-5 border border-gray-100">
            <h3 class="text-xl font-semibold text-gray-700 mb-2 pb-2 border-b border-gray-200">B2. Inter-personal Relations</h3>
            <p class="text-sm text-gray-500 italic mb-4">(if not applicable, select "NA")</p>
            
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">With supervisor</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_supervisor" id="b2_supervisor_1" value="1">
                        <label class="ml-1 text-gray-700" for="b2_supervisor_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_supervisor" id="b2_supervisor_2" value="2">
                        <label class="ml-1 text-gray-700" for="b2_supervisor_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_supervisor" id="b2_supervisor_3" value="3">
                        <label class="ml-1 text-gray-700" for="b2_supervisor_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_supervisor" id="b2_supervisor_4" value="4">
                        <label class="ml-1 text-gray-700" for="b2_supervisor_4">4</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_supervisor" id="b2_supervisor_na" value="NA">
                        <label class="ml-1 text-gray-700" for="b2_supervisor_na">NA</label>
                    </div>
                </div>
            </div> 

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">With colleagues</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_colleagues" id="b2_colleagues_1" value="1">
                        <label class="ml-1 text-gray-700" for="b2_colleagues_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_colleagues" id="b2_colleagues_2" value="2">
                        <label class="ml-1 text-gray-700" for="b2_colleagues_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_colleagues" id="b2_colleagues_3" value="3">
                        <label class="ml-1 text-gray-700" for="b2_colleagues_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_colleagues" id="b2_colleagues_4" value="4">
                        <label class="ml-1 text-gray-700" for="b2_colleagues_4">4</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_colleagues" id="b2_colleagues_na" value="NA">
                        <label class="ml-1 text-gray-700" for="b2_colleagues_na">NA</label>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">With subordinates</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_subordinates" id="b2_subordinates_1" value="1">
                        <label class="ml-1 text-gray-700" for="b2_subordinates_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_subordinates" id="b2_subordinates_2" value="2">
                        <label class="ml-1 text-gray-700" for="b2_subordinates_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_subordinates" id="b2_subordinates_3" value="3">
                        <label class="ml-1 text-gray-700" for="b2_subordinates_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_subordinates" id="b2_subordinates_4" value="4">
                        <label class="ml-1 text-gray-700" for="b2_subordinates_4">4</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_subordinates" id="b2_subordinates_na" value="NA">
                        <label class="ml-1 text-gray-700" for="b2_subordinates_na">NA</label>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">With students</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_students" id="b2_students_1" value="1">
                        <label class="ml-1 text-gray-700" for="b2_students_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_students" id="b2_students_2" value="2">
                        <label class="ml-1 text-gray-700" for="b2_students_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_students" id="b2_students_3" value="3">
                        <label class="ml-1 text-gray-700" for="b2_students_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_students" id="b2_students_4" value="4">
                        <label class="ml-1 text-gray-700" for="b2_students_4">4</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b2_students" id="b2_students_na" value="NA">
                        <label class="ml-1 text-gray-700" for="b2_students_na">NA</label>
                    </div>
                </div>
            </div>
        </div>

            
        <!-- B3.-->
        <div class="mb-8 bg-gray-50 rounded-lg shadow-sm p-5 border border-gray-100">
            <h3 class="text-xl font-semibold text-gray-700 mb-2 pb-2 border-b border-gray-200">B3. Contributions to Community Service</h3>
            <div class="mb-6">
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b3_community" id="b3_community_1" value="1">
                        <label class="ml-1 text-gray-700" for="b3_community_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b3_community" id="b3_community_2" value="2">
                        <label class="ml-1 text-gray-700" for="b3_community_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b3_community" id="b3_community_3" value="3">
                        <label class="ml-1 text-gray-700" for="b3_community_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b3_community" id="b3_community_4" value="4">
                        <label class="ml-1 text-gray-700" for="b3_community_4">4</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- B4. Understanding, appreciation and respect for Brunei -->
        <div class="mb-8 bg-gray-50 rounded-lg shadow-sm p-5 border border-gray-100">
            <h3 class="text-xl font-semibold text-gray-700 mb-2 pb-2 border-b border-gray-200">B4. Understanding, appreciation and respect for Brunei</h3>
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">a. culture particularly with the practise of Islam as a way of life</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b4_culture" id="b4_culture_1" value="1">
                        <label class="ml-1 text-gray-700" for="b4_culture_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b4_culture" id="b4_culture_2" value="2">
                        <label class="ml-1 text-gray-700" for="b4_culture_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b4_culture" id="b4_culture_3" value="3">
                        <label class="ml-1 text-gray-700" for="b4_culture_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b4_culture" id="b4_culture_4" value="4">
                        <label class="ml-1 text-gray-700" for="b4_culture_4">4</label>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">b. religious values, particularly Islam as the official religion</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b4_religious" id="b4_religious_1" value="1">
                        <label class="ml-1 text-gray-700" for="b4_religious_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b4_religious" id="b4_religious_2" value="2">
                        <label class="ml-1 text-gray-700" for="b4_religious_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b4_religious" id="b4_religious_3" value="3">
                        <label class="ml-1 text-gray-700" for="b4_religious_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b4_religious" id="b4_religious_4" value="4">
                        <label class="ml-1 text-gray-700" for="b4_religious_4">4</label>
                    </div>
                </div>
            </div> 
        </div>
        

        <!-- B5. Appraisal of teaching duties -->
        <div class="mb-8 bg-gray-50 rounded-lg shadow-sm p-5 border border-gray-100">
            <h3 class="text-xl font-semibold text-gray-700 mb-2 pb-2 border-b border-gray-200">B5. Appraisal of teaching duties</h3>
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Preparation of teaching material</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b5_preparation" id="b5_preparation_1" value="1">
                        <label class="ml-1 text-gray-700" for="b5_preparation_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b5_preparation" id="b5_preparation_2" value="2">
                        <label class="ml-1 text-gray-700" for="b5_preparation_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b5_preparation" id="b5_preparation_3" value="3">
                        <label class="ml-1 text-gray-700" for="b5_preparation_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b5_preparation" id="b5_preparation_4" value="4">
                        <label class="ml-1 text-gray-700" for="b5_preparation_4">4</label>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Attitude to teaching</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b5_attitude" id="b5_attitude_1" value="1">
                        <label class="ml-1 text-gray-700" for="b5_attitude_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b5_attitude" id="b5_attitude_2" value="2">
                        <label class="ml-1 text-gray-700" for="b5_attitude_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b5_attitude" id="b5_attitude_3" value="3">
                        <label class="ml-1 text-gray-700" for="b5_attitude_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b5_attitude" id="b5_attitude_4" value="4">
                        <label class="ml-1 text-gray-700" for="b5_attitude_4">4</label>
                    </div>
                </div>
            </div> 
        </div>

        <!-- B6. Appraisal of output and quality of  -->
        <div class="mb-8 bg-gray-50 rounded-lg shadow-sm p-5 border border-gray-100">
            <h3 class="text-xl font-semibold text-gray-700 mb-2 pb-2 border-b border-gray-200">B6. Appraisal of output and quality of</h3>
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">a. Research</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b6_research" id="b6_research_1" value="1"required>
                        <label class="ml-1 text-gray-700" for="b6_research_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b6_research" id="b6_research_2" value="2">
                        <label class="ml-1 text-gray-700" for="b6_research_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b6_research" id="b6_research_3" value="3">
                        <label class="ml-1 text-gray-700" for="b6_research_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b6_research" id="b6_research_4" value="4">
                        <label class="ml-1 text-gray-700" for="b6_research_4">4</label>
                    </div>
                </div>
            </div>

        </div>

    <div class="mb-8">
        <div class="mb-6">
            <label for="b7_strongest_points" class="block text-xl font-semibold text-gray-700 mb-2">
                B7. Give your opinion of the appraisee's strongest points
            </label>
            <textarea class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                      id="b7_strongest_points" name="b7_strongest_points" rows="4" required></textarea>
        </div>

        <div class="mb-6">
            <label for="b8_improvement_areas" class="block text-xl font-semibold text-gray-700 mb-2">
                B8. Describe areas needing attention or improvement by appraisee
            </label>
            <textarea class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                      id="b8_improvement_areas" name="b8_improvement_areas" rows="4" required></textarea>
        </div>

        <div class="mb-6">
            <label for="b9_other_comments" class="block text-xl font-semibold text-gray-700 mb-2">
                B9. Other comments, if any
            </label>
            <textarea class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                      id="b9_other_comments" name="b9_other_comments" rows="4"></textarea>
        </div>
    </div>

    <!-- B10. Leadership section with conditional display -->
    <div class="mb-8  bg-gray-50 rounded-lg shadow-sm p-5 border border-gray-100" id="leadershipSection">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">
            B10. Complete the following if the appraisee is a Dean or Deputy Dean or Head Of FICO
        </h3>
        
        <!-- Toggle for leadership section visibility -->
        <div class="mb-6">
            <div class="flex items-center">
                <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" 
                        type="checkbox" id="b_is_leadership_role" name="b_is_leadership_role">
                <label for="b_is_leadership_role" class="ml-2 text-gray-700">
                    Appraisee is in a leadership role (Dean/Deputy Dean/Head of FICO)
                </label>
                <div id="leadership-indicator" class="hidden ml-2">
                    <svg class="animate-spin h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <div id="leadership-ratings" class="hidden">
        <!-- Leadership qualities -->
        <div class="mb-6">
            <label class="block text-gray-700 mb-2">Leadership qualities</label>
            <div class="flex items-center gap-4 flex-wrap">
                <div class="flex items-center">
                    <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                        type="radio" name="b10_leadership_qualities" id="b10_leadership_qualities_1" value="1">
                    <label class="ml-1 text-gray-700" for="b10_leadership_qualities_1">1</label>
                </div>
                <div class="flex items-center">
                    <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                        type="radio" name="b10_leadership_qualities" id="b10_leadership_qualities_2" value="2">
                    <label class="ml-1 text-gray-700" for="b10_leadership_qualities_2">2</label>
                </div>
                <div class="flex items-center">
                    <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                        type="radio" name="b10_leadership_qualities" id="b10_leadership_qualities_3" value="3">
                    <label class="ml-1 text-gray-700" for="b10_leadership_qualities_3">3</label>
                </div>
                <div class="flex items-center">
                    <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                        type="radio" name="b10_leadership_qualities" id="b10_leadership_qualities_4" value="4">
                    <label class="ml-1 text-gray-700" for="b10_leadership_qualities_4">4</label>
                </div>
            </div>
            <!-- Problem-solving qualities -->
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Problem-solving qualities</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b10_problem_solving" id="b10_problem_solving_1" value="1">
                        <label class="ml-1 text-gray-700" for="b10_problem_solving_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b10_problem_solving" id="b10_problem_solving_2" value="2">
                        <label class="ml-1 text-gray-700" for="b10_problem_solving_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b10_problem_solving" id="b10_problem_solving_3" value="3">
                        <label class="ml-1 text-gray-700" for="b10_problem_solving_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b10_problem_solving" id="b10_problem_solving_4" value="4">
                        <label class="ml-1 text-gray-700" for="b10_problem_solving_4">4</label>
                    </div>
                </div>
            </div>

            <!-- Decision-making qualities -->
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Decision-making qualities</label>
                <div class="flex items-center gap-4 flex-wrap">
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b10_decision_making" id="b10_decision_making_1" value="1">
                        <label class="ml-1 text-gray-700" for="b10_decision_making_1">1</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b10_decision_making" id="b10_decision_making_2" value="2">
                        <label class="ml-1 text-gray-700" for="b10_decision_making_2">2</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b10_decision_making" id="b10_decision_making_3" value="3">
                        <label class="ml-1 text-gray-700" for="b10_decision_making_3">3</label>
                    </div>
                    <div class="flex items-center">
                        <input class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-full" 
                            type="radio" name="b10_decision_making" id="b10_decision_making_4" value="4">
                        <label class="ml-1 text-gray-700" for="b10_decision_making_4">4</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>  

    <!-- B11. Relationship to the appraisee with dynamic behavior -->
    <div class="mb-8  bg-gray-50 rounded-lg shadow-sm p-5 border border-gray-100">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">B11. Relationship to the appraisee</h3>
        
        <div class="mb-6">
            <label class="block text-gray-700 mb-2">a. I have known the appraisee for:</label>
            <div class="flex gap-4">
                <div class="w-32">
                    <input type="number" class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        id="b11_known_years" name="b11_known_years" 
                        placeholder="Years" min="0" required>
                    </div>
                <div class="w-32">
                    <input type="number" class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        id="b11_known_months" name="b11_known_months" 
                        placeholder="Months" min="0" max="11" required>
                    </div>
            </div>
        </div>

        <div class="mb-6">
            <label class="block text-gray-700 mb-2">b. Relationship to appraisee:</label>
            <div class="flex flex-col md:flex-row gap-4">
                <div class="w-full md:w-1/3">
                    <select class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                            id="b11_relationship" name="b11_relationship" required>                        <option value="">Select relationship</option>
                        <option value="Supervisor">Supervisor</option>
                        <option value="Colleague">Colleague</option>
                        <option value="Subordinate">Subordinate</option>
                        <option value="Other">Other (please specify)</option>
                    </select>
                </div>
                <div class="w-full md:w-2/3 hidden" id="relationshipOtherDiv">
                    <input type="text" class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                           id="b11_relationship_other" name="b11_relationship_other" 
                           placeholder="Please specify relationship">
                    </div>
                </div>
            </div>
        </div>
    

    <!-- Appraiser Review Date with auto-save -->
    <div class="mb-8">
        <div class="mb-6">
            <label for="appraiser_review_date" class="block text-xl font-semibold text-gray-700 mb-2">Date of Appraisal Review</label>
            <input type="date" class="px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                   id="b_appraiser_review_date" name="b_appraiser_review_date" required>
        </div>
    </div>

    <!-- Save indicator -->
    <div id="save-indicator" class="htmx-indicator fixed bottom-4 right-4 p-3 bg-white rounded-lg shadow-lg z-50">
        <div class="flex items-center">
            <svg class="animate-spin h-5 w-5 text-blue-500 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-gray-700">Saving...</span>
        </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="flex justify-between items-center mt-8 pt-4 border-t border-gray-200">
        <button type="submit" 
                name="wizard_goto_step" 
                value="{{ wizard.steps.prev }}" 
                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-colors">
            <span class="flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Previous
            </span>
        </button>

        <!-- Save as Draft Button -->
        <button type="button" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-green-500 transition-colors"
                id="save-draft-button"
                onclick="saveDraft()">
            <span class="flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                </svg>
                Save as Draft
            </span>
        </button>
        
        <div id="nav-indicator" class="htmx-indicator">
            <svg class="animate-spin h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </div>
        
        <button type="button" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
                id="next-button"
                hx-get="{% url 'appraisals:appraisal_wizard_section_c' appraisal_id=appraisal.appraisal_id %}"
                hx-target="#wizard-container"
                hx-swap="innerHTML"
                hx-push-url="true"
                hx-indicator="#nav-indicator">
            <span class="flex items-center">
                Next
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </span>
        </button>
    </div>
</div>
</form>
</div>
{% endblock %}
