<<<<<<< HEAD
{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-4">Manage Fields for Template: {{ template.name }}</h1>

    <!-- Template Settings -->
    <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
        <h2 class="text-xl font-semibold mb-4">Template Settings</h2>
        <form method="post" action="{% url 'contract_renewal:update_template' template.id %}" class="space-y-4">
            {% csrf_token %}
            <div class="flex items-center">
                <input type="checkbox" 
                       id="requires_employee" 
                       name="requires_employee" 
                       class="form-checkbox h-4 w-4 text-blue-600"
                       {% if template.requires_employee %}checked{% endif %}>
                <label for="requires_employee" class="ml-2 block text-gray-700">
                    Require Employee Selection
                </label>
            </div>
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Update Settings
            </button>
        </form>
    </div>

    <!-- Add Field Form -->
    <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
        <h2 class="text-xl font-semibold mb-4">Add New Field</h2>
        <form method="post" class="space-y-4">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Add Field
            </button>
        </form>
    </div>

    <!-- Fields List -->
    <div class="bg-white shadow-md rounded">
        <table class="min-w-full">
            <thead>
                <tr>
                    <th class="px-4 py-2">Label</th>
                    <th class="px-4 py-2">Type</th>
                    <th class="px-4 py-2">Required</th>
                    <th class="px-4 py-2">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for field in fields %}
                <tr class="border-b">
                    <td class="px-4 py-2">{{ field.label }}</td>
                    <td class="px-4 py-2">{{ field.get_field_type_display }}</td>
                    <td class="px-4 py-2">
                        {% if field.required %}
                            <span class="text-green-500">Yes</span>
                        {% else %}
                            <span class="text-gray-500">No</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-2 flex space-x-2">
                        <button type="button" 
                                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded edit-field-btn" 
                                data-field-id="{{ field.id }}"
                                data-field-label="{{ field.label }}"
                                data-field-type="{{ field.field_type }}"
                                data-field-choices="{{ field.choices|default:'' }}"
                                data-field-help-text="{{ field.help_text|default:'' }}"
                                data-field-placeholder="{{ field.placeholder|default:'' }}"
                                data-field-required="{{ field.required|yesno:'true,false' }}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <form method="post" action="{% url 'contract_renewal:delete_field' field.id %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Edit Field Modal -->
    <div id="editFieldModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Edit Field</h3>
                <form id="editFieldForm" method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="field_id" id="editFieldId">
                    
                    <div class="mb-4">
                        <label for="editFieldLabel" class="block text-gray-700 text-sm font-bold mb-2">Label</label>
                        <input type="text" name="label" id="editFieldLabel" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>

                    <div class="mb-4">
                        <label for="editFieldType" class="block text-gray-700 text-sm font-bold mb-2">Field Type</label>
                        <select name="field_type" id="editFieldType" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            {% for type_value, type_label in form.fields.field_type.choices %}
                                <option value="{{ type_value }}">{{ type_label }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-4">
                        <label for="editFieldChoices" class="block text-gray-700 text-sm font-bold mb-2">Choices (comma-separated)</label>
                        <textarea name="choices" id="editFieldChoices" rows="3" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
                    </div>

                    <div class="mb-4">
                        <label for="editFieldHelpText" class="block text-gray-700 text-sm font-bold mb-2">Help Text</label>
                        <input type="text" name="help_text" id="editFieldHelpText" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>

                    <div class="mb-4">
                        <label for="editFieldPlaceholder" class="block text-gray-700 text-sm font-bold mb-2">Placeholder</label>
                        <input type="text" name="placeholder" id="editFieldPlaceholder" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>

                    <div class="mb-4">
                        <label class="inline-flex items-center">
                            <input type="checkbox" name="required" id="editFieldRequired" class="form-checkbox">
                            <span class="ml-2">Required</span>
                        </label>
                    </div>

                    <div class="flex justify-end space-x-2">
                        <button type="button" id="closeEditModal" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                            Cancel
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const editButtons = document.querySelectorAll('.edit-field-btn');
    const editModal = document.getElementById('editFieldModal');
    const closeModalBtn = document.getElementById('closeEditModal');
    const editFieldForm = document.getElementById('editFieldForm');

    editButtons.forEach(button => {
        button.addEventListener('click', function() {
            const fieldId = this.dataset.fieldId;
            editFieldForm.action = "{% url 'contract_renewal:edit_field' 999 %}".replace('999', fieldId);
            
            document.getElementById('editFieldId').value = fieldId;
            document.getElementById('editFieldLabel').value = this.dataset.fieldLabel;
            document.getElementById('editFieldType').value = this.dataset.fieldType;
            document.getElementById('editFieldChoices').value = this.dataset.fieldChoices;
            document.getElementById('editFieldHelpText').value = this.dataset.fieldHelpText;
            document.getElementById('editFieldPlaceholder').value = this.dataset.fieldPlaceholder;
            document.getElementById('editFieldRequired').checked = (this.dataset.fieldRequired === 'true');

            editModal.classList.remove('hidden');
        });
    });

    closeModalBtn.addEventListener('click', function() {
        editModal.classList.add('hidden');
    });

    editModal.addEventListener('click', function(event) {
        if (event.target === editModal) {
            editModal.classList.add('hidden');
        }
    });
});
</script>
=======
{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-center align-items-center mb-4">
        <h1 class="text-primary text-center">
            <i class="fas fa-edit"></i> <strong>Manage Fields: {{ template.name }}</strong>
        </h1>
        <a href="{% url 'contract_renewal:template_list' %}" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded">
            <i class="fas fa-arrow-left"></i> Back to Templates
        </a>
    </div>

    <div class="row">
        <!-- Add New Field Form -->
        <div class="col-md-6">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h3 class="h4 mb-0"><i class="fas fa-plus-circle"></i> Add New Field</h3>
                </div>
                <div class="card-body">
                    <form method="post" class="needs-validation">
                        {% csrf_token %}
                        
                        <!-- Field Label -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <label for="{{ form.label.id_for_label }}" class="form-label">
                                    Field Label <span class="text-danger">*</span>
                                </label>
                                {{ form.label }}
                                {% if form.label.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.label.errors|join:", " }}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Field Type -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <label for="{{ form.field_type.id_for_label }}" class="form-label">
                                    Field Type <span class="text-danger">*</span>
                                </label>
                                {{ form.field_type }}
                                {% if form.field_type.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.field_type.errors|join:", " }}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Choices (for select/radio/checkbox) -->
                        <div class="card mb-3" id="choices-field">
                            <div class="card-body">
                                <label for="{{ form.choices.id_for_label }}" class="form-label">
                                    Choices (one per line)
                                </label>
                                {{ form.choices }}
                                <small class="form-text text-muted">
                                    Required for dropdown, radio buttons, and checkboxes
                                </small>
                                {% if form.choices.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.choices.errors|join:", " }}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Help Text -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <label for="{{ form.help_text.id_for_label }}" class="form-label">
                                    Help Text
                                </label>
                                {{ form.help_text }}
                                <small class="form-text text-muted">
                                    Optional explanation text shown below the field
                                </small>
                            </div>
                        </div>

                        <!-- Required Field -->
                        <div class="card mb-3">
                            <div class="card-body form-check">
                                {{ form.required }}
                                <label class="form-check-label" for="{{ form.required.id_for_label }}">
                                    Required Field
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                            <i class="fas fa-save"></i> Add Field
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Existing Fields List -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h3 class="h4 mb-0"><i class="fas fa-list"></i> Existing Fields</h3>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        {% for field in fields %}
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h5 class="mb-1">{{ field.label }}</h5>
                                    <p class="mb-1 text-muted">
                                        <small>Type: {{ field.get_field_type_display }}</small>
                                    </p>
                                    {% if field.help_text %}
                                    <p class="mb-1 text-muted">
                                        <small>Help: {{ field.help_text }}</small>
                                    </p>
                                    {% endif %}
                                    {% if field.choices %}
                                    <p class="mb-1 text-muted">
                                        <small>Choices: {{ field.choices|linebreaksbr }}</small>
                                    </p>
                                    {% endif %}
                                </div>
                                <div class="ms-2 d-flex flex-column align-items-end">
                                    {% if field.required %}
                                    <span class="badge bg-primary mb-2">Required</span>
                                    {% endif %}
                                    <div class="btn-group">
                                        <form method="post" 
                                              action="{% url 'contract_renewal:delete_field' field.id %}" 
                                              onsubmit="return confirm('Are you sure you want to delete this field?');" 
                                              style="display: inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-info-circle fa-2x mb-2"></i>
                            <p>No fields added yet.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fieldTypeSelect = document.getElementById('{{ form.field_type.id_for_label }}');
    const choicesField = document.getElementById('choices-field');

    function toggleChoicesField() {
        const selectedValue = fieldTypeSelect.value;
        const needsChoices = ['select', 'radio', 'checkbox'].includes(selectedValue);
        choicesField.style.display = needsChoices ? 'block' : 'none';
    }

    fieldTypeSelect.addEventListener('change', toggleChoicesField);
    toggleChoicesField(); // Initial state
});

// Add smooth deletion animation
document.querySelectorAll('form[action*="delete_field"]').forEach(form => {
    form.addEventListener('submit', function(e) {
        e.preventDefault(); // Prevent form submission immediately
        
        if (confirm('Are you sure you want to delete this field?')) {
            const listItem = this.closest('.list-group-item');
            listItem.classList.add('deleting');
            
            // Submit the form after animation
            setTimeout(() => {
                this.submit();
            }, 300);
        }
    });
});
</script>
{% endblock %}

{% block extra_css %}
<style>
    .card {
        border-radius: 8px;
        margin-bottom: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .card-header {
        border-radius: 8px 8px 0 0;
    }
    .list-group-item {
        transition: all 0.2s;
    }
    .list-group-item:hover {
        background-color: #f8f9fa;
    }
    .badge {
        font-size: 0.8rem;
        padding: 0.4em 0.8em;
    }
    .form-label {
        font-weight: 500;
    }
    .text-danger {
        font-weight: bold;
    }
    
    .list-group-item .badge {
        margin-bottom: 0.5rem;
    }
    
    /* Add animation for deletion */
    .list-group-item {
        transition: all 0.3s ease-in-out;
    }
    
    .list-group-item.deleting {
        opacity: 0;
        transform: translateX(100%);
    }

    /* Increase font size for Manage Fields heading */
    .manage-fields-heading {
        font-size: 2rem; /* Adjust the size as needed */
    }

    /* Hover effect for the card */
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .btn-group {
        display: flex;
        gap: 0.5rem;
    }

    /* Add transition for form updates */
    .needs-validation {
        transition: all 0.3s ease-in-out;
    }

    /* Add visual feedback for edit mode */
    .needs-validation[action*="edit"] {
        background-color: #fff8e8;
        padding: 1rem;
        border-radius: 8px;
    }
</style>
>>>>>>> 991468ee1458877423928edfaf88cf3290d54d9a
{% endblock %}